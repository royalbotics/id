<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ro&Botâ„¢ ID â€“ Login</title>
<link rel="icon" href="https://i.ibb.co/Jw6dV46h/favicon.png" type="image/png">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --platinum-bg: linear-gradient(145deg, #f9f9f9, #f0f0f0, #f4f4f4);
  --accent: #c4a484;
  --text: #111;
  --muted: #555;
  --error-color: #E07A5F; /* warm coral */
  --error-bg: rgba(224, 122, 95, 0.1);
}

* { box-sizing:border-box; margin:0; padding:0; font-family:'Poppins', sans-serif; }

body {
  height:100vh;
  width:100vw;
  background: var(--platinum-bg);
  display:flex;
  justify-content:center;
  align-items:center;
  color: var(--text);
  overflow:hidden;
  position:relative;
}

.main-container {
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
  width:100%;
  max-width:480px;
  padding:0 20px;
  animation: fadeIn 0.8s ease;
}

.logo-id {
  display:flex; align-items:center; justify-content:center; gap:12px; margin-bottom:12px;
}
.logo-id img { height:50px; }
.logo-id span { font-size:2.6rem; font-weight:700; color: var(--text); }

.subtitle {
  font-size:1.4rem;
  color: var(--muted);
  margin-bottom:30px;
}

.form-group {
  position: relative;
  margin-bottom: 22px;
  width:100%;
}
.form-group input {
  width:100%;
  padding:18px 16px;
  border:none;
  border-bottom:1px solid rgba(0,0,0,0.1);
  font-size:1rem;
  background: transparent;
  color: var(--text);
  transition: all 0.3s;
}
.form-group input::placeholder { color: transparent; }
.form-group input:focus {
  border-bottom:2px solid var(--accent);
  outline:none;
}
.form-group label {
  position:absolute;
  left:16px;
  top:50%;
  transform:translateY(-50%);
  color:var(--muted);
  font-size:0.9rem;
  transition:0.25s;
  pointer-events:none;
}
.form-group input:focus + label,
.form-group input:not(:placeholder-shown) + label {
  top:-6px; left:0;
  font-size:0.75rem;
  color:var(--accent);
}

.btn {
  width:100%;
  padding:16px;
  font-size:1rem;
  font-weight:600;
  border:none;
  border-radius:12px;
  background: linear-gradient(135deg, #d6bfa9, #c4a484);
  color:#fff;
  cursor:pointer;
  transition: all 0.3s;
  margin-top:12px;
}
.btn:hover { opacity:0.9; transform: translateY(-1px); }

.switch-link {
  margin-top:20px;
  text-align:center;
  font-size:0.9rem;
  color:var(--muted);
}
.switch-link a {
  color:var(--accent); font-weight:500; cursor:pointer;
  transition:0.3s;
}
.switch-link a:hover { text-decoration:underline; }

#messageBox {
  margin-top:15px;
  font-size:0.9rem;
  text-align:center;
  min-height:24px;
  border-radius:8px;
  padding:6px 10px;
}

#messageBox.error {
  color: var(--error-color);
  background: var(--error-bg);
  display: inline-block;
  animation: pulse 1.2s ease-in-out infinite;
}

#messageBox.success {
  color: #28a745;
  background: rgba(40, 167, 69, 0.1);
  border-radius: 8px;
  display: inline-block;
}



.loader {
  display: inline-block;
  width: 26px;
  height: 26px;
  border: 3px solid rgba(0,0,0,0.2);
  border-top: 3px solid var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: auto;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

body::before {
  content:"";
  position:absolute; inset:0;
  background: radial-gradient(circle at 25% 25%, rgba(196,164,132,0.05), transparent 60%),
              radial-gradient(circle at 75% 75%, rgba(196,164,132,0.05), transparent 60%);
  background-size:200% 200%;
  animation: floatBg 20s linear infinite;
  z-index:-1;
}

@keyframes floatBg {
  0% { background-position:0% 0%, 100% 100%; }
  50% { background-position:50% 50%, 50% 50%; }
  100% { background-position:0% 0%, 100% 100%; }
}

@keyframes fadeIn {
  from {opacity:0; transform:translateY(25px);}
  to {opacity:1; transform:translateY(0);}
}
</style>
</head>
<body>

<div class="main-container">
  <div class="logo-id">
    <img src="https://roandbot.com/logo-main.png" alt="Ro&Botâ„¢">
    <span>ID</span>
  </div>
  <div class="subtitle" id="formSubtitle">Login</div>

  <form id="authForm"></form>
  <div id="messageBox"></div>

  <div class="switch-link">
    Donâ€™t have an account? <a href="/signup/">Sign up</a>
  </div>
</div>

<script>
// ===== Encryption Helpers =====
const ENC_KEY = "ro&bot-login-key";

async function getKey() {
  const enc = new TextEncoder();
  return crypto.subtle.importKey("raw", enc.encode(ENC_KEY), "AES-GCM", false, ["encrypt", "decrypt"]);
}

async function encryptData(data) {
  const enc = new TextEncoder();
  const iv = crypto.getRandomValues(new Uint8Array(12));
  const key = await getKey();
  const cipher = await crypto.subtle.encrypt({ name: "AES-GCM", iv }, key, enc.encode(data));
  return { iv: Array.from(iv), cipher: Array.from(new Uint8Array(cipher)) };
}

async function decryptData(payload) {
  try {
    const { iv, cipher } = payload;
    const key = await getKey();
    const plainBuffer = await crypto.subtle.decrypt({ name: "AES-GCM", iv: new Uint8Array(iv) }, key, new Uint8Array(cipher));
    return new TextDecoder().decode(plainBuffer);
  } catch {
    return null;
  }
}

async function saveLogin(email) {
  const encrypted = await encryptData(email);
  localStorage.setItem("savedLogin", JSON.stringify({ encrypted, time: Date.now() }));
}

async function getSavedLogin() {
  const raw = localStorage.getItem("savedLogin");
  if (!raw) return null;
  try {
    const data = JSON.parse(raw);
    const oneDay = 24 * 60 * 60 * 1000;
    if (Date.now() - data.time < oneDay) {
      const email = await decryptData(data.encrypted);
      if (email) return email;
    } else {
      localStorage.removeItem("savedLogin");
    }
  } catch { return null; }
  return null;
}

// ===== UI Helpers =====
function showMessage(msg, type="error") {
  const box = document.getElementById("messageBox");
  box.innerHTML = msg;
  box.className = type;
}

function showLoader() {
  const box = document.getElementById("messageBox");
  box.innerHTML = `<div class="loader"></div>`;
  box.className = "";
}

// ===== Login Flow =====
let step = 1;
const form = document.getElementById("authForm");

async function renderStep() {
  form.innerHTML = "";
  if (step === 1) {
    form.innerHTML = `
      <div class="form-group">
        <input type="email" id="email" required placeholder="">
        <label for="email">Email</label>
      </div>
      <button type="button" class="btn" id="nextBtn">Next</button>
    `;
    document.getElementById("nextBtn").addEventListener("click", handleEmailSubmit);

    // auto-fill from local storage
    const saved = await getSavedLogin();
    if (saved) {
      document.getElementById("email").value = saved;
      step = 2;
      renderStep();
    }
  } else if (step === 2) {
    const emailVal = document.getElementById("email") ? document.getElementById("email").value : await getSavedLogin();
    form.innerHTML = `
      <div class="form-group">
        <input type="password" id="password" required placeholder="">
        <label for="password">Password</label>
      </div>
      <button type="submit" class="btn">Login</button>
    `;
    showMessage("", ""); // clear
  }
}

async function handleEmailSubmit() {
  const email = document.getElementById("email").value.trim();
  if (!email) { showMessage("Please enter your email."); return; }

  showLoader();
  try {
    const res = await fetch("https://server.id.roandbot.com/check-email", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ email })
    });
    const data = await res.json();

    if (res.ok && data.status === "existing") {
      step = 2;
      renderStep();
      showMessage("", "");
    } else if (res.ok && data.status === "new") {
      window.location.href = "/signup/?email=" + encodeURIComponent(email);
    } else {
      showMessage("Hmm, that email doesnâ€™t seem right. Try again?", "error");
    }
  } catch {
    showMessage("We couldnâ€™t reach the server. Please try again in a moment.", "error");
  }
}

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  if (!password) { showMessage("Donâ€™t forget your password!", "error"); return; }

  showLoader();
  try {
    const res = await fetch("https://server.id.roandbot.com/login", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ email, password })
    });
    const data = await res.json();

    if (res.ok) {
      showMessage("Welcome back ðŸ‘‹", "success");
      await saveLogin(email);
    } else {
      showMessage("That password doesnâ€™t look right. Try again?", "error");
    }
  } catch {
    showMessage("Something went wrong. Please try again later.", "error");
  }
});

// init
renderStep();
</script>

</body>
</html>
